/*
 * This file is a part of https://github.com/HunHage/Audy, also known as Audy
 *
 * Audy is licensed under the Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License.
 * To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/4.0/ or send a letter to
 * Creative Commons, PO Box 1866, Mountain View, CA 94042, USA.
 *
 * Audy is provided without any warranty, including any implied warranty.
 */

package net.exploitables.audy;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import java.io.File;
import java.util.Properties;

public class AudyMain {
    // Invite Link
    // https://discordapp.com/api/oauth2/authorize?client_id=<<<BOT_ID>>>&permissions=0&scope=bot

    private static final Logger logger = LoggerFactory.getLogger(AudyMain.class);

    private static AudyConfig configuration;
    private static Properties properties;
    private static String version;

    private static AudyClient audyClient;
    private static String token;

    /**
     * Main entry point for the bot
     * @param args arguments passed in externally
     */
    public static void main(String[] args) {
        if (args.length == 1) {
            token = args[0];
        } else {
            logger.error(args.length + " arguments passed to main, please only pass as single argument for the token.");
            System.exit(-1);
        }

        try {
            // Configuration file, external
            configuration = AudyConfigLoader.loadConfiguration();
            // Project Properties, internal, created when compiled
            properties = new Properties();
            properties.load(AudyMain.class.getClassLoader().getResourceAsStream("project.properties"));
            version = 'v' + properties.getProperty("buildversion");

            // Create directory for logs if it does't exist
            File thrownLogsDirectory = new File("Logs\\Thrown\\");
            if (!thrownLogsDirectory.mkdirs() && !thrownLogsDirectory.exists()) {
                logger.error("Couldn't create directories for logging!");
                System.exit(-1);
            }
        } catch (Exception e) {
            StringBuilder builder = new StringBuilder();
            for (StackTraceElement ste : e.getStackTrace()) { builder.append(ste).append("\n"); }
            logger.error("Exception occurred while loading configuration and internal properties");
            logger.error(e.getMessage());
            logger.error(builder.toString());
            System.exit(-1);
        }

        AudyDatabase.setupDatabase();

        logger.info("Blocking main thread until disconnect.");
        AudyClient.getClient().blockUntilDisconnect();
    }

    public static AudyConfig getConfiguration() { return configuration; }
    public static String     getVersion()       { return version; }
    public static String     getToken()         { return token; }
}
