package net.exploitables.audy.commands.arguments;

import net.exploitables.audy.internal.ArgsList;
import org.junit.Before;
import org.junit.Test;

import java.util.Arrays;

import static org.junit.Assert.*;

public class ArgumentParserImplTest {

    static class ArgumentParserImplTester extends ArgumentParserImpl {
        ArgumentParserImplTester() {
            this.arguments.add(new ArgumentBuilder("p", "param", "an argument that wants a parameter").setHasParameter(true).setValueParser(s -> s).build());
        }
    }

    ArgumentParserImplTester apTest;

    @Before
    public void setUp() {
        apTest = new ArgumentParserImplTester();
    }

    @Test
    public void parseArgsEmpty() {
        // Create an args list that would match an example "test" command
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test"));
        // test is our command, advance after it
        argsList.advance();
        // Parse the argsList
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
    }

    @Test
    public void parseArgsShortOptNoParam() {
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "-h"));
        argsList.advance();
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertNull(result.castValue("help", String.class).orElse(null));
    }

    @Test
    public void parseArgsShortOptWithParam() {
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "-p", "example", "param"));
        argsList.advance();
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertEquals("example param", result.castValue("param", String.class).orElse("null"));
    }

    @Test
    public void parseArgsLongOptNoParam() {
        // Create an args list that would match an example "test" command
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "--help"));
        // test is our command, advance after it
        argsList.advance();
        // Parse the argsList
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertNull(result.castValue("help", String.class).orElse(null));
    }

    @Test
    public void parseArgsLongOptWithParam() {
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "--param", "example", "param"));
        argsList.advance();
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertEquals("example param", result.castValue("param", String.class).orElse("null"));
    }

    @Test
    public void parseArgsLongWithAndWithoutParam1() {
        // Create an args list that would match an example "test" command
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "--param", "example", "param", "--help"));
        // test is our command, advance after it
        argsList.advance();
        // Parse the argsList
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertEquals("example param", result.castValue("param", String.class).orElse("null"));
        assertNull(result.castValue("help", String.class).orElse(null));
    }

    @Test
    public void parseArgsLongWithAndWithoutParam2() {
        // Create an args list that would match an example "test" command
        ArgsList argsList = new ArgsList(Arrays.asList("a-", "test", "--help", "--param", "example", "param"));
        // test is our command, advance after it
        argsList.advance();
        // Parse the argsList
        ArgumentParserResult result = apTest.parseArgs(argsList).block();

        assertNotNull(result);
        assertFalse(result.hasError());
        assertEquals("example param", result.castValue("param", String.class).orElse("null"));
        assertNull(result.castValue("help", String.class).orElse(null));
    }
}